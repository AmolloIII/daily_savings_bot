name: Friday Savings Emails

# Schedule: Every Friday 7 PM Kenya Time (UTC+3 â†’ 16:00 UTC)
on:
  schedule:
    - cron: '0 16 * * 5'   # GitHub Actions uses UTC
  workflow_dispatch:        # Allow manual triggering

jobs:
  friday-savings:
    runs-on: ubuntu-latest

    env:
      MY_GMAIL_ACCOUNT: ${{ secrets.MY_GMAIL_ACCOUNT }}
      SMTP_PASSWORD: ${{ secrets.SMTP_PASSWORD }}
      SHEET_ID: ${{ secrets.SHEET_ID }}
      GSHEET_CREDENTIALS: ${{ secrets.GSHEET_CREDENTIALS }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install system dependencies for webshot2
        run: |
          sudo apt-get update
          sudo apt-get install -y libcurl4-openssl-dev libssl-dev libxml2-dev \
                                  chromium-browser chromium-chromedriver \
                                  libfontconfig1-dev

      - uses: r-lib/actions/setup-r@v2

      - name: Install R packages
        run: |
          Rscript -e '
            pkgs <- c("googlesheets4","dplyr","blastula","httr","glue",
                      "lubridate","gt","webshot2","htmltools","jsonlite")
            install.packages(pkgs, repos="https://cloud.r-project.org")
          '

      - name: Run Friday Savings Email
        run: |
          Rscript friday_savings_email.R
